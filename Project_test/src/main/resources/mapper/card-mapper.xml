<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.card.CardDao">

    <!-- 카드 번호 중복 체크 -->
    <select id="isCardNoExists" parameterType="long" resultType="boolean">
        SELECT COUNT(*) > 0 FROM card WHERE card_no = #{cardNo}
    </select>

    <!-- 카드 정보 저장 -->
    <insert id="save" parameterType="com.example.demo.card.Card">
        INSERT INTO card (card_no, ex_date, cvc, member_username)
        VALUES (#{cardNo}, #{exDate}, #{cvc}, #{memberUsername})
    </insert>

    <!-- 카드 번호로 카드 정보 조회 -->
    <select id="findById" parameterType="long" resultMap="CardReadResultMap">
        SELECT * FROM card WHERE card_no = #{cardNo}
    </select>

    <!-- 회원 아이디로 카드 정보 조회 -->
    <select id="findAllByUsername" parameterType="string" resultMap="CardReadResultMap">
        SELECT * FROM card WHERE member_username = #{memberUsername}
    </select>

    <!-- 카드 정보 업데이트 -->
    <update id="update" parameterType="com.example.demo.card.Card">
        UPDATE card
        SET ex_date = #{exDate}, cvc = #{cvc}
        WHERE card_no = #{cardNo}
    </update>

    <!-- 카드 정보 삭제 -->
    <delete id="delete" parameterType="long">
        DELETE FROM card WHERE card_no = #{cardNo}
    </delete>

    <!-- 카드 조회를 위한 CardReadResultMap -->
    <resultMap id="CardReadResultMap" type="com.example.demo.card.CardDto.Read">
        <id property="cardNo" column="card_no" />
        <result property="exDate" column="ex_date" />
        <result property="cvc" column="cvc" />
        <result property="memberUsername" column="member_username" />
    </resultMap>

</mapper>
