<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.dao.ProductDao">

    <insert id="save" useGeneratedKeys="true">
        <selectKey keyProperty="pno" order="BEFORE" resultType="long">
            select item_seq.nextval from dual
        </selectKey>
        insert into item(item_no, item_irum, item_price, item_jadgo, item_info, cno)
        values(#{pno}, #{vendor}, #{name}, #{price}, #{stock}, #{info}, #{cno})
    </insert>
    
    <resultMap id="joinMap" type="com.example.demo.dto.ItemDto$Read">
        <id property="pno" column="item_no" />
        <result property="vendor" column="item_irum" />
        <result property="name" column="item_irum" />
        <result property="info" column="item_info" />
        <result property="price" column="item_price" />
        <result property="stock" column="item_jadgo" />
        <collection property="images" javaType="java.util.List" ofType="string">
            <result column="image_name" />
        </collection>
    </resultMap>
    
    <select id="findById" resultMap="joinMap">
        select i.*, #{imageUrl} || im.image_name as image 
        from item i 
        join image im on i.item_no = im.item_no 
        where i.item_no = #{pno}
    </select>
</mapper>