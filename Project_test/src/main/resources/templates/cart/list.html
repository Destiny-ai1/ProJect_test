<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="/style/main.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="/script/inputFunction.js"></script>
<title>장바구니</title>
</head>
<body>
    <div id="app">
        <!-- 공통 헤더 영역 불러오기 -->
        <header th:replace="~{/fragment/header.html}"> </header>
        <!-- 공통 네비게이션 영역 불러오기 -->
        <nav th:replace="~{/fragment/nav.html}"></nav>
        <main>
            <section class="cart-container">
                <h1>장바구니</h1>
                <!-- 장바구니가 비어 있을 때 메시지 표시 -->
                <div th:if="${emptyMessage != null}">
                    <p th:text="${emptyMessage}"></p> <!-- '장바구니가 비어 있습니다.' 메시지를 출력 -->
                </div>
                <!-- 장바구니 항목이 있을 때 목록 표시 -->
                <div class="cart-items" th:if="${result != null}">
                    <div th:each="item : ${result}" class="cart-item">
                        <div class="item-image">
                            <img th:src="${item.imageName}" alt="상품명"> <!-- 상품 이미지 출력 -->
                        </div>
                        <div class="item-details">
                            <h2 class="item-name" th:text="${item.itemIrum}">상품명</h2> <!-- 상품명 출력 -->
                            <p class="item-price" th:text="'₩ ' + ${item.cartPrice}">₩ 가격</p> <!-- 상품 개별 가격 출력 -->
                            <div class="item-quantity">
                                <label for="quantity" th:for="'quantity-' + ${item.itemNo}">수량:</label>
                                <input type="number" th:id="'quantity-' + ${item.itemNo}" name="quantity" th:value="${item.cartEa}" min="1" class="form-control"> <!-- 수량 입력 필드 -->
                            </div>
                            <!-- 장바구니 항목 수정 폼 -->
                            <form th:action="@{/cart/update}" method="post" th:object="${item}">
                                <input type="hidden" name="${_csrf.parameterName}" th:value="${_csrf.token}" /> <!-- CSRF 토큰 추가 -->
                                <input type="hidden" name="itemNo" th:value="${item.itemNo}" /> <!-- 수정할 상품 번호 -->
                                <input type="hidden" name="username" th:value="${item.username}" /> <!-- 사용자 이름 -->
                                <input type="number" name="cartEa" th:value="${item.cartEa}" min="1" class="form-control mt-2" /> <!-- 수정할 수량 입력 -->
                                <button type="submit" class="btn btn-warning mt-2">수정</button> <!-- 수정 버튼 -->
                            </form>
                            <!-- 장바구니 항목 삭제 폼 -->
                            <form th:action="@{/cart/delete}" method="post" th:object="${item}">
                                <input type="hidden" name="_csrf" th:if="${_csrf != null}" th:value="${_csrf.token}" /> <!-- CSRF 토큰 추가 -->
                                <input type="hidden" name="itemNo" th:value="${item.itemNo}" /> <!-- 삭제할 상품 번호 -->
                                <button type="submit" class="btn btn-danger mt-2">삭제</button> <!-- 삭제 버튼 -->
                            </form>
                        </div>
                        <div class="item-total-price" th:text="'₩ ' + ${item.cartTotalPrice}">₩ 합계</div> <!-- 상품 총 가격 출력 -->
                    </div>
                </div>
                <!-- 장바구니 총합계 및 주문하기 버튼 -->
                <div class="cart-summary" th:if="${result != null}">
                    <h2>총 합계</h2>
                    <p class="total-price" th:text="'₩ ' + ${totalPrice}">₩ 총합계</p> <!-- 장바구니 총 합계 출력 -->
                    <a href="/order" class="btn btn-primary checkout-button">주문하기</a> <!-- 주문하기 버튼 -->
                </div>
            </section>
        </main>
        <!-- 공통 푸터 영역 불러오기 -->
        <footer th:replace="~{/fragment/footer.html}"> </footer>
    </div>
</body>
</html>
