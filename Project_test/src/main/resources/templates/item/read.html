<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"  xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
<meta charset="UTF-8">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="/style/main.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" rel="stylesheet">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<style>
	#info {
		min-height: 600px;
		background-color: #eee;	
	}
		
	.thumbnail {
		cursor: pointer;
	}
	.choice {
		border: 3px solid red;
	}
</style>
<script>
	$(document).ready(function() {
		const _csrf = '[[${_csrf.token}]]';
		
		$('.thumbnail:first-of-type').addClass("choice");
		
		$('.thumbnail').click(function() {
			$('.thumbnail').removeClass("choice");
			$(this).addClass("choice");
			$('#image').attr('src', $(this).attr('src'));
		});
		
		$('#add-cart').click(function() {
			const pno = '[[${result.pno}]]';
			$.ajax({
				url: '/api/carts',
				method: 'post',
				data: {pno, _csrf},
				success() {
					alert("장바구니에 상품을 담았습니다");
				}, error() {
					alert("상품을 담을 수 없습니다");
				}
			})
		});		
	});
</script>	
<title>Insert title here</title>
</head>
<body>
	<div id="app">
		<header th:replace="~{/fragment/header.html}"> </header>
		<nav th:replace="~{/fragment/nav.html}"></nav>
		<section>
			<div class="mb-3">
				<img id="image" style="height:250px;" th:src="${result.images[0]}">
			</div>
			<div>
				<img th:each="image:${result.images}" th:src="${image}" style="height:100px;" class="thumbnail">
			</div>
			<div th:text="${result.vendor} + ' ' + ${result.name} + '(' + ${result.price} + '원)'">
			</div>
			<div id="info" th:utext="${result.info}"></div>
			<div sec:authorize="hasRole('ROLE_USER') or hasRole('ROLE_SOCIAL')">
				<button class="btn btn-danger" id="add-cart">장바구니 담기</button>
			</div>
			<div sec:authorize="isAnonymous()">
				<button class="btn btn-secondary" disabled>장바구니 담기를 위해 로그인</button>
			</div>
		</section>
		<footer th:replace="~{/fragment/footer.html}"> </footer>
	</div>		
</body>
</html>