<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="/style/main.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="/script/input.js"></script>
<title>아이디 및 비밀번호 찾기</title>
<style>
    .center-container {
        min-height: 80vh; /* 세로 중앙에 맞추기 위한 높이 설정 */
    }
 </style>   
</head>
<body>
	<div id="app">
		<header th:replace="~{/fragment/header.html}"> </header>
		<nav th:replace="~{/fragment/nav.html}"></nav>
		<main class="d-flex justify-content-center align-items-center center-container">
			<section class="text-center" style="width: 100%; max-width: 500px;">
				<div class="alert alert-danger" style="display:none;">
		    		<strong id="message"></strong>
				<div class="alert alert-danger" style="display:none;">
		    		<strong id="message"></strong>
		  		</div>
		  		</div>
		  		<!-- 아이디 찾기 -->
		  		<div>
		  			<h1>아이디 찾기</h1>
		  			<p>아이디를 찾을 수단을 선택해 주세요</p>
                    <form id="id-search-form">
                      <label for="sel1" class="form-label">아이디 찾기 목록:</label>
                      <select class="form-select" id="sel1" name="sellist1">
                        <option value="">-선택하기-</option>
                        <option value="email">이메일로 찾기</option>
                        <option value="phone">전화번호로 찾기</option>
                      </select>
                    </form>

                    <!-- 이메일 입력창 -->
                    <div id="emailInput" class="mt-3" style="display: none;">
                        <label for="name" class="form-label">이름 입력:</label>
                        <input type="text" class="form-control" id="name" placeholder="이름을 입력하세요" name="name">
                        <br>
                        <label for="email" class="form-label">이메일 입력:</label>
                        <input type="email" class="form-control" id="email" placeholder="이메일을 입력하세요" name="email">
                        <button type="button" class="btn btn-outline-primary btn-block mt-2" id="find-id-email">아이디 찾기</button>
                    </div>

                    <!-- 전화번호 입력창 -->
                    <div id="phoneInput" class="mt-3" style="display: none;">
                        <label for="name" class="form-label">이름 입력:</label>
                        <input type="text" class="form-control" id="name" placeholder="이름을 입력하세요" name="name">
                        <br>
                        <label for="phone" class="form-label">전화번호 입력:</label>
                        <input type="tel" class="form-control" id="phone" placeholder="전화번호를 입력하세요" name="phone">
                        <button type="button" class="btn btn-outline-primary btn-block mt-2" id="find-id-phone">아이디 찾기</button>
                    </div>
		  		</div>
		  		<hr>

		  		<!-- 비밀번호 찾기 -->
		  		<div>
		  			<h1>비밀번호 찾기</h1>
		  			<p>비밀번호를 찾을 수단을 선택해 주세요</p>
                    <form id="password-search-form">
                      <label for="sel2" class="form-label">비밀번호 찾기 목록:</label>
                      <select class="form-select" id="sel2" name="sellist2">
                        <option value="">-선택하기-</option>
                        <option value="email">이메일로 찾기</option>
                        <option value="phone">전화번호로 찾기</option>
                      </select>
                    </form>

                    <!-- 비밀번호 찾기 이메일 입력창 -->
                    <div id="passwordEmailInput" class="mt-3" style="display: none;">
                        <label for="loginid" class="form-label">아이디 입력:</label>
                        <input type="loginid" class="form-control" id="loginid" placeholder="아이디를 입력하세요" name="passwordEmail">
                        <br>
                        <label for="name" class="form-label">이름 입력:</label>
                        <input type="text" class="form-control" id="name" placeholder="이름을 입력하세요" name="name">
                        <br>
                        <label for="passwordEmail" class="form-label">이메일 입력:</label>
                        <input type="email" class="form-control" id="passwordEmail" placeholder="이메일을 입력하세요" name="passwordEmail">
                        <button type="button" class="btn btn-outline-primary btn-block mt-2" id="find-password-email">비밀번호 찾기</button>
                    </div>

                    <!-- 비밀번호 찾기 전화번호 입력창 -->
                    <div id="passwordPhoneInput" class="mt-3" style="display: none;">
                        <label for="loginid" class="form-label">아이디 입력:</label>
                        <input type="loginid" class="form-control" id="loginid" placeholder="아이디를 입력하세요" name="passwordEmail">
                        <br>
                        <label for="name" class="form-label">이름 입력:</label>
                        <input type="text" class="form-control" id="name" placeholder="이름을 입력하세요" name="name">
                        <br>
                        <label for="passwordPhone" class="form-label">전화번호 입력:</label>
                        <input type="tel" class="form-control" id="passwordPhone" placeholder="전화번호를 입력하세요" name="passwordPhone">
                        <button type="button" class="btn btn-outline-primary btn-block mt-2" id="find-password-phone">비밀번호 찾기</button>
                    </div>
		  		</div>
			</section>
		</main>
		<footer th:replace="~{/fragment/footer.html}"> </footer>
	</div>			
    <script>
        // 선택지에 따라 아이디 찾기 입력창 표시
        $('#sel1').change(function() {
            const selectedValue = $(this).val();
            if (selectedValue === 'email') {
                $('#emailInput').show();
                $('#phoneInput').hide();
            } else if (selectedValue === 'phone') {
                $('#phoneInput').show();
                $('#emailInput').hide();
            } else {
                $('#emailInput').hide();
                $('#phoneInput').hide();
            }
        });
    
        // 선택지에 따라 비밀번호 찾기 입력창 표시
        $('#sel2').change(function() {
            const selectedValue = $(this).val();
            if (selectedValue === 'email') {
                $('#passwordEmailInput').show();
                $('#passwordPhoneInput').hide();
            } else if (selectedValue === 'phone') {
                $('#passwordPhoneInput').show();
                $('#passwordEmailInput').hide();
            } else {
                $('#passwordEmailInput').hide();
                $('#passwordPhoneInput').hide();
            }
        });
    
        // 이메일로 아이디 찾기
        $('#find-id-email').click(async function() {
            const name = $('#name').val();
            const email = $('#email').val();
            if (!name || !email) {
                alert('이름과 이메일을 모두 입력해 주세요.');
                return;
            }
            try {
                const result = await $.ajax({
                    url: '/members/username',
                    method: 'GET',
                    data: { name: name, email: email }
                });
                $('#message').text('아이디 : ' + result).parent().css('display', 'block');
            } catch (err) {
                console.log(err);
                $('#message').text("아이디를 찾지 못했습니다.").parent().css('display', 'block');
            }
        });
    
        // 전화번호로 아이디 찾기
        $('#find-id-phone').click(async function() {
            const name = $('#name').val();
            const phone = $('#phone').val();
            if (!name || !phone) {
                alert('이름과 전화번호를 모두 입력해 주세요.');
                return;
            }
            try {
                const result = await $.ajax({
                    url: '/members/username',
                    method: 'GET',
                    data: { name: name, phone: phone }
                });
                $('#message').text('아이디 : ' + result).parent().css('display', 'block');
            } catch (err) {
                console.log(err);
                $('#message').text("아이디를 찾지 못했습니다.").parent().css('display', 'block');
            }
        });
    
        // 이메일로 비밀번호 찾기
        $('#find-password-email').click(async function() {
            const loginid = $('#loginid').val();
            const name = $('#name').val();
            const email = $('#passwordEmail').val();
            if (!loginid || !name || !email) {
                alert('아이디, 이름, 이메일을 모두 입력해 주세요.');
                return;
            }
            try {
                const result = await $.ajax({
                    url: '/members/reset-password',
                    method: 'PATCH',
                    data: { loginid: loginid, name: name, email: email }
                });
                $('#message').text('임시 비밀번호가 이메일로 전송되었습니다.').parent().css('display', 'block');
            } catch (err) {
                console.log(err);
                $('#message').text("사용자를 찾지 못했습니다").parent().css('display', 'block');
            }
        });
    
        // 전화번호로 비밀번호 찾기
        $('#find-password-phone').click(async function() {
            const loginid = $('#loginid').val();
            const name = $('#name').val();
            const phone = $('#passwordPhone').val();
            if (!loginid || !name || !phone) {
                alert('아이디, 이름, 전화번호를 모두 입력해 주세요.');
                return;
            }
            try {
                const result = await $.ajax({
                    url: '/members/reset-password',
                    method: 'PATCH',
                    data: { loginid: loginid, name: name, phone: phone }
                });
                $('#message').text('임시 비밀번호가 SMS로 전송되었습니다.').parent().css('display', 'block');
            } catch (err) {
                console.log(err);
                $('#message').text("사용자를 찾지 못했습니다").parent().css('display', 'block');
            }
        });
       </script>
    </body>
</html>







